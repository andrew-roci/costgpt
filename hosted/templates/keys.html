{% extends "base.html" %}
{% block title %}API Keys - CostGPT{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-gray-900 border border-gray-800 rounded-lg p-6 mb-6">
        <h1 class="text-2xl font-semibold text-white mb-4">API Keys</h1>
        <p class="text-gray-400 text-sm mb-4">Use API keys to track costs from your applications.</p>
        <form method="POST" action="/keys/create" class="flex gap-2">
            <input type="text" name="name" placeholder="Key name (e.g., Production)" required
                class="flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white text-sm focus:outline-none focus:border-gray-600">
            <button type="submit" class="bg-white text-gray-900 px-4 py-2 rounded hover:bg-gray-200 text-sm">Create Key</button>
        </form>
    </div>

    {% if new_key %}
    <div class="bg-green-900/30 border border-green-900 rounded-lg p-4 mb-6">
        <h3 class="font-semibold text-green-300 mb-2">New API Key Created</h3>
        <p class="text-sm text-green-400 mb-2">Copy this key now. You won't be able to see it again!</p>
        <code class="block bg-gray-900 p-3 rounded border border-gray-700 font-mono text-sm text-white break-all">{{ new_key }}</code>
    </div>
    {% endif %}

    <div class="bg-gray-900 border border-gray-800 rounded-lg">
        <div class="p-4 border-b border-gray-800">
            <h2 class="font-semibold text-white">Your Keys</h2>
        </div>
        <div class="divide-y divide-gray-800">
            {% for key in keys %}
            <div class="p-4 flex justify-between items-center">
                <div>
                    <div class="font-medium text-white">{{ key.name or 'Unnamed' }}</div>
                    <div class="text-sm text-gray-500">
                        {{ key.key_prefix }}*******
                        | Created: {{ key.created_at.strftime('%Y-%m-%d') }}
                        {% if key.last_used_at %}| Last used: {{ key.last_used_at.strftime('%Y-%m-%d') }}{% endif %}
                    </div>
                </div>
                <form method="POST" action="/keys/{{ key.id }}/revoke" onsubmit="return confirm('Revoke this key?')">
                    <button type="submit" class="text-red-400 hover:text-red-300 text-sm">Revoke</button>
                </form>
            </div>
            {% else %}
            <div class="p-4 text-gray-500">No API keys yet</div>
            {% endfor %}
        </div>
    </div>

    <div class="mt-6 bg-gray-900 border border-gray-800 rounded-lg p-4">
        <h3 class="font-semibold text-white mb-3">Usage</h3>
        <pre class="bg-gray-800 p-4 rounded text-sm overflow-x-auto text-gray-300"><code><span class="text-purple-400">from</span> costgpt <span class="text-purple-400">import</span> CostTracker

tracker = CostTracker(api_key=<span class="text-green-400">"your-api-key"</span>)
tracker.instrument_anthropic()

<span class="text-gray-500"># Track by user and feature</span>
tracker.track(
    model=<span class="text-green-400">"claude-sonnet-4-20250514"</span>,
    input_tokens=1500,
    output_tokens=800,
    user_id=<span class="text-green-400">"user_123"</span>,
    feature=<span class="text-green-400">"chat"</span>,
)</code></pre>
    </div>
</div>
{% endblock %}
